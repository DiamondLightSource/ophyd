Python IOC <==> aioca/p4p Performance Tests
===========================================

Packages used:

- aioca             1.4
- epicscorelibs     7.0.6.99.2.0
- epicsdbbuilder    1.5
- p4p               4.1.1
- psutil            5.9.1
- pvxslibs          0.3.1
- softioc           4.1.0


Performance (Python IOC / aioca)
********************************

- IOC on p45-control
- Client on p45-ws001
- Monitoring network for 20s and averaging
- CPU monitored with top


=====  ========  ======  ==========  ==========  ======  ==========  ======  ==========  ==========
Server                                           Client
-----------------------------------------------  --------------------------------------------------
N PVs  Rate(Hz)  CPU(%)  Sent(kB/s)  Recv(kB/s)  N PVs   N Monitors  CPU(%)  Sent(kB/s)  Recv(kB/s)
=====  ========  ======  ==========  ==========  ======  ==========  ======  ==========  ==========
0      0         0       6           6           0       0           0       1           0
1      100       6       520         3           1       1000        120     2           528
1      10        1       245         5           1       1000        61      3           245
1000   10        126     915         340         1000    1           71      330         915
500    10        60      460         335         500     1           45      335         460
100    100       90      257         12          1       100         58      23          280
100    100       95      516         12          100     10          120     3           506
100    100       105     520         10          100     50          120     3           512
100    100       cbLow ring buffer full          100     70          
-----  --------  ------------------------------  ------  ----------  ------  ----------  ----------
=====  ========  ======  ==========  ==========  ======  ==========  ======  ==========  ==========


Attempts to increase the number of PVs above 100 with 100Hz update rate resulted in failures of the
Python IOC (with no monitors).  Data rates did not appear to be altered by increasing the number of 
monitors on individual PVs (perhaps to be expected if the client is intelligent)



Performance (Python IOC / p4p)
******************************

- IOC on p45-control
- Client on p45-ws001
- Monitoring network for 20s and averaging
- CPU monitored with top


=====  ========  ======  ==========  ==========  ======  ==========  ======  ==========  ==========
Server                                           Client
-----------------------------------------------  --------------------------------------------------
N PVs  Rate(Hz)  CPU(%)  Sent(kB/s)  Recv(kB/s)  N PVs   N Monitors  CPU(%)  Sent(kB/s)  Recv(kB/s)
=====  ========  ======  ==========  ==========  ======  ==========  ======  ==========  ==========
0      0         0       6           6           0       0           0       1           0
1      100       25      1150        5           1       1000        120     5           1150
1      10        22      540         7           1       1000        63      4           540
1000   10        159     1050        325         1000    1           60      325         1050
500    10        75      600         310         500     1           50      310         600
100    100       112     552         16          1       100         62      8           541
100    100       125     1155        15          100     10          129     6           1127
100    100       125     1215        15          100     50          132     5           1160
100    100       132     1215        14          100     70          132     5           1175
100    100       135     1200        15          100     100         135     4           1155
100    100       200     1200        15          100     1000        132     4           1155
-----  --------  ------------------------------  ------  ----------  ------  ----------  ----------
=====  ========  ======  ==========  ==========  ======  ==========  ======  ==========  ==========



Performance (Python IOC inbuilt Calc records / aioca)
*****************************************************

=====  ========  ======  ==========  ==========  ======  ==========  ======  ==========  ==========
Server                                           Client
-----------------------------------------------  --------------------------------------------------
N PVs  Rate(Hz)  CPU(%)  Sent(kB/s)  Recv(kB/s)  N PVs   N Monitors  CPU(%)  Sent(kB/s)  Recv(kB/s)
=====  ========  ======  ==========  ==========  ======  ==========  ======  ==========  ==========
1      10        <1      1           1           1       1           <1      1           1
1      10        <1      3           1           1       10          1       1           3
1      10        <1      25          1           1       100         9       1           25
1      10        1       245         3           1       1000        60      1           244
10     10        <1      3           1           10      1           1       1           3 
10     10        <1      26          2           10      10          8       2           26
10     10        4       250         5           10      100         58      6           248
10     10        3       455         2           10      1000        120     2           450 
100    10        <1      25          2           100     1           8       2           25
100    10        5       250         8           100     10          57      6           250
100    10        4       500         3           100     100         120     2           500
100    10        30      1700        120         100     1000        140     120         1700
1000   10        7       260         11          1000    1           60      10          256    
1000   10        11      550         2           1000    10          120     2           550   
1000   10        20      1700        130         1000    100         132     170         1700   
1000   10        130     1750        70          1000    1000        140     80          1750   
-----  --------  ------  ----------  ----------  ------  ----------  ------  ----------  ----------
=====  ========  ======  ==========  ==========  ======  ==========  ======  ==========  ==========


Performance (Python IOC inbuilt Calc records / aioca - using FORMAT_TIME)
*************************************************************************

=====  ========  ======  ==========  ==========  ======  ==========  ======  ==========  ==========
Server                                           Client
-----------------------------------------------  --------------------------------------------------
N PVs  Rate(Hz)  CPU(%)  Sent(kB/s)  Recv(kB/s)  N PVs   N Monitors  CPU(%)  Sent(kB/s)  Recv(kB/s)
=====  ========  ======  ==========  ==========  ======  ==========  ======  ==========  ==========
10     10        6       400         5           10      100         66      6           400
10     10        4       580         2           10      1000        118     2           580 
100    10        5       690         3           100     100         118     5           690
1000   10        10      420         11          1000    1           70      10          420    
1000   10        15      700         10          1000    10          115     10          700   
-----  --------  ------  ----------  ----------  ------  ----------  ------  ----------  ----------
=====  ========  ======  ==========  ==========  ======  ==========  ======  ==========  ==========


Performance (Python IOC inbuilt Calc records / p4p)
***************************************************

=====  ========  ======  ==========  ==========  ======  ==========  ======  ==========  ==========
Server                                           Client
-----------------------------------------------  --------------------------------------------------
N PVs  Rate(Hz)  CPU(%)  Sent(kB/s)  Recv(kB/s)  N PVs   N Monitors  CPU(%)  Sent(kB/s)  Recv(kB/s)
=====  ========  ======  ==========  ==========  ======  ==========  ======  ==========  ==========
1      10        <1      1           1           1       1           <1      1           1
1      10        <1      5           1           1       10          <1      1           5
1      10        3       55          1           1       100         10      1           55
1      10        22      540         4           1       1000        62      2           540
10     10        <1      5           1           10      1           1       1           5
10     10        1       55          1           10      10          10      1           55
10     10        14      542         2           10      100         61      2           542 
10     10        10      1195        7           10      1000        131     6           1190
100    10        1       60          2           100     1           10      2           60
100    10        15      545         5           100     10          60      5           543
100    10        11      1200        6           100     100         130     6           1200
100    10        28      1200        10          100     1000        130     10          1200
1000   10        16      555         5           1000    1           62      3           557
1000   10        15      1200        5           1000    10          132     5           1200
1000   10        32      1200        5           1000    100         132     5           1200
1000   10        118     4000        15          1000    1000        128     15          4000
-----  --------  ------  ----------  ----------  ------  ----------  ------  ----------  ----------
=====  ========  ======  ==========  ==========  ======  ==========  ======  ==========  ==========


Performance (P4P server and client)
***********************************


=====  ========  ======  ==========  ==========  ======  ==========  ======  ==========  ==========
Server                                           Client
-----------------------------------------------  --------------------------------------------------
N PVs  Rate(Hz)  CPU(%)  Sent(kB/s)  Recv(kB/s)  N PVs   N Monitors  CPU(%)  Sent(kB/s)  Recv(kB/s)
=====  ========  ======  ==========  ==========  ======  ==========  ======  ==========  ==========
1      10        <1      <1          <1          1       1           <1      <1          <1
1      10        <1      1           2           1       10          1       1           2
1      10        <1      22          1           1       100         10      1           21
1      10        2       199         2           1       1000        60      2           198
10     10        1       3           1           10      1           2       1           3
10     10        1       22          1           10      10          10      2           21
10     10        3       200         2           10      100         60      2           198
10     10        9       460         10          10      1000        122     10          480
100    10        5       22          3           100     1           6       4           23
100    10        5       200         5           100     10          58      3           200
100    10        30      400         3           100     100         126     2           400
100    10        100     400         3           100     1000        128     3           405
1000   10        45      205         10          1000    1           60      8           202
1000   10        55 (then drops to 25)           1000    10          126     2           400
-----  --------  ------------------------------  ------  ----------  ------  ----------  ----------
1000   10        105 Errors, not keeping up      1000    100         128     Unstable    Unstable
-----  --------  ------------------------------  ------  ----------  ------  ----------  ----------
=====  ========  ======  ==========  ==========  ======  ==========  ======  ==========  ==========


Performance (Python IOC inbuilt Calc records and various clients)
*****************************************************************

=====  ========  =======  ==========  ======  =====================================================
N PVs  Rate(Hz)  Client   N Monitors  CPU(%)  Notes
=====  ========  =======  ==========  ======  =====================================================
100    10        aioca    10          72
100    10        p4p      10          63
100    10        caproto  10          16      It looks like this does not create duplicate monitors
100    10        pyepics  10          5       It looks like this does not create duplicate monitors
1000   10        aioca    1           72
1000   10        p4p      1           59
1000   10        caproto  1           54
1000   10        pyepics  1           35
=====  ========  =======  ==========  ======  =====================================================





Conclusion
**********

The use of Python to update record values is less efficient (which is to be expected) than native datbase
updates.  Using a pure python based server (p4p server) was also not as efficient. 
These tests did not verify that the 100Hz updates were received without loss by the clients as no verification
was made by the clients on the quantity or values received.
